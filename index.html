<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel="shortcut icon" href="https://motajs.github.io/homepage-tmp/favicon.ico">
<style>
body,iframe,div {margin:0;padding:0;font-family: Verdana, 微软雅黑}
a {text-decoration:none;color:rgb(0, 4, 255);}
iframe {border-width:0;}
.Container {width:100%;}
.main {width:100%;}
#background {position: fixed;top: 0;left: 0;z-index: -1;width: 100%;height: 100%;pointer-events: none;}

#sortTowerSelect{margin:10px;background-color:rgba(252, 252, 252, 0.6)}

.towerTab {
  background-color:rgba(252, 252, 252, 0.6);
  border-radius: 2px;
  box-sizing: border-box;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,.14), 0 3px 1px -2px rgba(0,0,0,.2), 0 1px 5px 0 rgba(0,0,0,.12);
} 
.towerTab:hover {
  box-shadow: 0 2px 2px 0 rgba(87, 198, 232,.74), 0 3px 1px -2px rgba(87, 198, 232,.80), 0 1px 5px 0 rgba(87, 198, 232,.72);
}
.towerTab {
  float: left;
  margin: 5px 5px 5px 10px;
  overflow: auto;
  
  height: 193px;
  width: 324px;

  position:relative;
}

.towerAuths {
  position:absolute;left:10px;bottom:10px;
}
.towerAuth {
  font-size: 16px;
  color: #6e6e6e;
}
.towerAuth2 {
  font-size: 16px;
  color: #a1a1a1;
}
.towerTag {
  font-size: 14px;
  color: #828282;
  text-shadow: 0px 0px 1px rgba(128, 128, 128, 0.7);
  position:absolute;right:10px;bottom:10px;
}
.towerInfo {
  font-size: 10px;
  background-color:rgba(240, 240, 240, 0.6);
  position: absolute;
  top: 35px;
  left: 0;
  bottom: 26px;
  right: 0;
  overflow: auto;
}

.towerAuthString{
  font-size: 0.65em;
  position: absolute;
  left: 0;
  bottom: 26px;
}

.towerTab {color:black;}
.towerTab > *{margin:5px 10px;}
.towerTab > :first-child{margin-top:10px;}
.towerTab > :last-child{margin-bottom:10px;}

</style>
</head>
<body><pre id="mobilecss" style="display: none;">

</pre>
<!-- css END -->
<script type="text/javascript">
  var twidth = 345;
  var ratio = 1.25/(window.devicePixelRatio || 1);
  if (ratio>1.0001) {
    twidth=~~(twidth*ratio);
  }
  isMobile=0;
  if(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)){
    isMobile=1;
  }
  if(isMobile){
    /* var cssNode=document.createElement("style");
    cssNode.innerHTML=mobilecss.innerText;
    document.head.appendChild(cssNode); */
    //document.head.innerHTML+='<style>'+mobilecss.innerText+'</style>';
    var wt = 2;//~~(innerWidth/twidth);
    twidth=~~(innerWidth/wt)-20;
  }
  var theight = ~~(twidth*193/324);
  var cssNode=document.createElement("style");
  cssNode.innerHTML=['.towerTab {',
    'height: ',theight,'px;','width: ',twidth,
    'px;','}\n'
  ].join('');
  document.head.appendChild(cssNode);
</script>
<canvas id="background"></canvas>
<script>
(function(){
  //背景
  var background = document.getElementById('background');
  var resize = function(){
    
    var ratio = window.devicePixelRatio || 1;
    var dc=background.getContext('2d');
    
    background.width = innerWidth*ratio;
    background.height = innerHeight*ratio;
    dc.scale(ratio, ratio);

    var bsize=32+isMobile*32;
    var fullWidth=~~((innerWidth-17)*ratio);
    var fullHeight=~~(innerHeight*ratio);
    
    var fullX=~~(fullWidth/bsize)-1;
    var fullY=~~(fullHeight/bsize)-1;

    var colorA=["#f9f9f9","#fdfdfd"];
    var colorIndex =1;
    for(ii=0;ii<=fullX+1;ii++){
      colorIndex=ii%2;
      for(jj=0;jj<=fullY+1;jj++){
        dc.fillStyle=colorA[colorIndex];
        if(Math.random()<0.03)dc.fillStyle='#'+'ef'[~~(Math.random()*2)]+''+'ef'[~~(Math.random()*2)]+''+'ef'[~~(Math.random()*2)];
        colorIndex=1-colorIndex;
        dc.fillRect(ii*bsize,jj*bsize,bsize,bsize);
      }
    }
  };
  resize();
  window.onresize = resize;
})();
</script>

<div class='Container'>

<div class='main'>
  <div id='towers'>
    <!-- <div class="towerTab" id="pageinfo">
      <p>HTML5魔塔交流群 : 539113091</p>
      <div class="towerInfo">
          <select style="margin:0" id='sortTowerSelect'>
              <option value="default">按[难度+tag]排序</option>
              <option value="difficulty">按难度排序</option>
              <option value="time">按发布时间排序</option>
              <option value="popularity">按人气排序</option>
            </select>
        <p>页面搭建中,更多功能有待添加,欢迎在<a href="https://github.com/ckcz123/mota-js/issues/22">issues/22</a>中提建议</p>
      
        <p><a href="https://github.com/ckcz123/mota-js">开源项目地址</a></p>
        <p><a href="https://ckcz123.com/games/template/">Demo / 样板效果</a></p>
      
        <p><a href="http://www.bilibili.com/video/av17608025/">Video / 视频教程</a></p>
        <p><a href="https://ckcz123.github.io/mota-js">Docs / 使用文档说明</a></p>
      </div>
    </div> -->
  </div>
  <!-- <a href="#"><div class="towerTab"><p>aaa</p></div></a> -->
</div>

<!-- ============ -->
<br style="clear:both"><br>
<select style="margin:0" id='sortTowerSelect'>
  <option value="default">按[难度+tag]排序</option>
  <option value="maxTime">按max达成时间排序</option>
  <option value="difficulty">按难度排序</option>
  <option value="time">按发布时间排序</option>
  <option value="popularity">按人气排序</option>
  <option value="首发">筛选[首发]tag</option>
</select>
<hr>
<div style='margin:10px'>
  <p>HTML5魔塔交流群 : 539113091</p>
  <p>页面搭建中,更多功能有待添加,欢迎在<a href="https://github.com/ckcz123/mota-js/issues/22">issues/22</a>中提建议</p>

  <p><a href="https://github.com/ckcz123/mota-js">开源项目地址</a></p>
  <p><a href="https://ckcz123.com/games/template/">Demo / 样板效果</a></p>

  <p><a href="http://www.bilibili.com/video/av17608025/">Video / 视频教程</a></p>
  <p><a href="https://ckcz123.github.io/mota-js">Docs / 使用文档说明</a></p>

  <p><a href="https://tieba.baidu.com/f?ie=utf-8&kw=%E9%AD%94%E5%A1%94">友情链接 : 魔塔吧</a></p>

</div>

</div>
<script>
(function(){  
  //<!-- urlmap START -->
  urlmap = {
'shenghua': {'auth': 'CC',
       'auth2': '冰魂',
       'long': 'https://ckcz123.com/games/shenghua/',
       'short': ['生化实验室——单层', 'shenghua', 't36'],
       'tag': [],
       'towerid': 'shenghua'},  
'24': {'auth': '胖老鼠',
       'auth2': '小艾',
       'long': 'https://ckcz123.com/games/24/',
       'short': ['24层魔塔', '24', 't29'],
       'tag': [{'三原塔': 10000}],
       'towerid': '24'},
'ComplexWorld': {'auth': '花落雨沾湿',
                 'auth2': '小艾',
                 'long': 'https://ckcz123.com/games/ComplexWorld/',
                 'short': ['Complex World', 'ComplexWorld', 't15'],
                 'tag': [{'新': 5}],
                 'towerid': 'ComplexWorld'},
'baobei51': {'auth': '数码宝贝51',
             'auth2': '数码宝贝51',
             'long': 'https://ckcz123.com/games/baobei51/',
             'short': ['魔塔-宝贝51吧 平面休闲塔', 'baobei51', 't35'],
             'tag': [{'首发': 10}, {'新': 5}],
             'towerid': 'baobei51'},
'benghuai3': {'auth': '红衣',
              'auth2': '小艾',
              'long': 'https://ckcz123.com/games/benghuai3/',
              'short': ['崩坏3', 'benghuai3', 't12'],
              'tag': [{'新': 5}],
              'towerid': 'benghuai3'},
'chongsheng': {'auth': '小艾',
               'auth2': '小艾',
               'long': 'https://ckcz123.com/games/chongsheng/',
               'short': ['重生塔', 'chongsheng', 't28'],
               'tag': [{'新': 5}],
               'towerid': 'chongsheng'},
'fengleijidu': {'auth': '见见',
                'auth2': '见见',
                'long': 'https://ckcz123.com/games/fengleijidu/',
                'short': ['风雷缉毒', 'fengleijidu', 't5'],
                'tag': [{'首发': 10}, {'新': 5}],
                'towerid': 'fengleijidu'},
'hansel': {'auth': '阻激夹域',
           'auth2': '小艾',
           'long': 'https://ckcz123.com/games/hansel/',
           'short': ['汉塞尔与格莱特', 'hansel', 't8'],
           'tag': [{'新': 5}],
           'towerid': 'hansel'},
'hanyungu': {'auth': '终末之扉',
             'auth2': '终末之扉',
             'long': 'https://ckcz123.com/games/hanyungu/',
             'short': ['寒云谷', 'hanyungu', 't27'],
             'tag': [{'新': 5}],
             'towerid': 'hanyungu'},
'huanta': {'auth': '淡血雾',
           'auth2': '淡血雾',
           'long': 'https://ckcz123.com/games/huanta/',
           'short': ['幻塔', 'huanta', 't30'],
           'tag': [{'首发': 10}, {'新': 5}],
           'towerid': 'huanta'},
'intermediate': {'auth': 'flynn',
                 'auth2': 'zhaouv',
                 'long': 'https://ckcz123.com/games/intermediate/',
                 'short': ['冥中手', 'intermediate', 't26'],
                 'tag': [{'首发': 10}, {'新': 5}],
                 'towerid': 'intermediate'},
'jia20f': {'auth': '终末之扉',
           'auth2': '淡血雾',
           'long': 'https://ckcz123.com/games/jia20f/',
           'short': ['假·20层魔塔', 'jia20f', 't18'],
           'tag': [{'新': 5}],
           'towerid': 'jia20f'},
'jianchuan1': {'auth': '雨兰清风',
               'auth2': '雨兰清风',
               'long': 'https://ckcz123.com/games/jianchuan1/',
               'short': ['剑主的传说(序章)', 'jianchuan1', 't22'],
               'tag': [{'首发': 10}, {'新': 5}],
               'towerid': 'jianchuan1'},
'jianchuan2': {'auth': '雨兰清风',
               'auth2': '雨兰清风',
               'long': 'https://ckcz123.com/games/jianchuan2/',
               'short': ['剑主的传说（破晓）', 'jianchuan2', 't32'],
               'tag': [{'首发': 10}, {'新': 5}],
               'towerid': 'jianchuan2'},
'jiange': {'auth': '终末之扉',
           'auth2': '终末之扉',
           'long': 'https://ckcz123.com/games/jiange/',
           'short': ['剑阁', 'jiange', 't33'],
           'tag': [{'首发': 10}, {'新': 5}],
           'towerid': 'jiange'},
'jianmo1': {'auth': 'worcher',
            'auth2': '小艾',
            'long': 'https://ckcz123.com/games/jianmo1/',
            'short': ['歼魔计划人类篇', 'jianmo1', 't10'],
            'tag': [{'新': 5}],
            'towerid': 'jianmo1'},
'jinengta': {'auth': '小红帽',
             'auth2': '小红帽',
             'long': 'https://ckcz123.com/games/jinengta/',
             'short': ['普通的技能塔', 'jinengta', 't36'],
             'tag': [{'首发': 10}, {'新': 5}],
             'towerid': 'jinengta'},
'jing6ta': {'auth': '59',
            'auth2': '冰魂',
            'long': 'https://ckcz123.com/games/jing6ta/',
            'short': ['能让641震惊的魔塔', 'jing6ta', 't19'],
            'towerid': 'jing6ta'},
'juesai1f': {'auth': '肥鸡',
             'auth2': '见见',
             'long': 'https://ckcz123.com/games/juesai1f/',
             'short': ['决赛塔1层', 'juesai1f', 't2'],
             'towerid': 'juesai1f'},
'kebianjiadian': {'auth': '小艾',
                  'auth2': '小艾',
                  'long': 'https://ckcz123.com/games/kebianjiadian/',
                  'short': ['可变加点单层塔', 'kebianjiadian', 't23'],
                  'tag': [{'新': 5}],
                  'towerid': 'kebianjiadian'},
'kengta0': {'auth': '专家',
            'auth2': '冰魂',
            'long': 'https://ckcz123.com/games/kengta0/',
            'short': ['坑系魔塔之坑塔', 'kengta0', 't17'],
            'towerid': 'kengta0'},
'kerong': {'auth': '大白貂',
           'auth2': '小艾',
           'long': 'https://ckcz123.com/games/kerong/',
           'short': ['可绒塔', 'kerong', 't25'],
           'tag': [{'首发': 10}, {'新': 5}],
           'towerid': 'kerong'},
'lisaier': {'auth': '鸿儒',
            'auth2': '小艾',
            'long': 'https://ckcz123.com/games/lisaier/',
            'short': ['莉赛尔的仓库', 'lisaier', 't9'],
            'towerid': 'lisaier'},
'lugunshi': {'auth': '魔塔吧会员',
             'auth2': '641',
             'long': 'https://ckcz123.com/games/lugunshi/',
             'short': ['露滚匙', 'lugunshi', 't24'],
             'tag': [{'新': 5}],
             'towerid': 'lugunshi'},
'mengsi': {'auth': '用户名已注销',
           'auth2': '用户名已注销',
           'long': 'https://ckcz123.com/games/mengsi/',
           'short': ['萌死塔', 'mengsi', 't13'],
           'tag': [{'首发': 10}, {'新': 5}],
           'towerid': 'mengsi'},
'mogai24': {'auth': '胖老鼠',
            'auth2': '小艾',
            'long': 'https://ckcz123.com/games/mogai24/',
            'short': ['魔改24层', 'mogai24', 't31'],
            'towerid': 'mogai24'},
'pacman': {'auth': 'zhaouv',
           'auth2': 'zhaouv',
           'authString': '<p class="towerAuthString"><span title="RMB200">悬赏已由<b>花落雨沾湿</b>领取</span></p>',
           'long': 'https://ckcz123.com/games/pacman/',
           'short': ['吃豆人魔塔', 'pacman', 't7'],
           'tag': [{'首发': 10}, {'新': 5}],
           'towerid': 'pacman'},
'random': {'auth': '冰魂',
           'auth2': '冰魂',
           'long': 'https://ckcz123.com/games/random/',
           'short': ['无尽轮回', 'random', 't34'],
           'tag': [{'首发': 10}, {'新': 5}],
           'towerid': 'random'},
'seaend': {'auth': '蓝晶',
           'auth2': '小艾',
           'long': 'https://ckcz123.com/games/seaend/',
           'short': ['海洋的尽头', 'seaend', 't6'],
           'towerid': 'seaend'},
'shilian20f': {'auth': '小艾',
               'auth2': '小艾',
               'long': 'https://ckcz123.com/games/shilian20f/',
               'short': ['20层的试炼', 'shilian20f', 't4'],
               'tag': [{'新': 5}],
               'towerid': 'shilian20f'},
'shilianzhidi': {'auth': '59',
                 'auth2': '小艾',
                 'long': 'https://ckcz123.com/games/shilianzhidi/',
                 'short': ['试炼之地', 'shilianzhidi', 't11'],
                 'towerid': 'shilianzhidi'},
'siwangzhiyu': {'auth': '凌影__戮神歃风',
                'auth2': '小艾',
                'long': 'https://ckcz123.com/games/siwangzhiyu/',
                'short': ['死亡之域', 'siwangzhiyu', 't1'],
                'tag': [{'新': 5}],
                'towerid': 'siwangzhiyu'},
'xiaokenggu': {'auth': '狼族',
               'auth2': '冰魂',
               'long': 'https://ckcz123.com/games/xiaokenggu/',
               'short': ['风之谷2', 'xiaokenggu', 't20'],
               'towerid': 'xiaokenggu'},
'xiaoxiaoluzhu': {'auth': '大白貂',
                  'auth2': '淡血雾',
                  'long': 'https://ckcz123.com/games/xiaoxiaoluzhu/',
                  'short': ['小小露珠之塔', 'xiaoxiaoluzhu', 't21'],
                  'tag': [{'新': 5}],
                  'towerid': 'xiaoxiaoluzhu'},
'yicengxiaota': {'auth': '鸿儒',
                 'auth2': '小艾',
                 'long': 'https://ckcz123.com/games/yicengxiaota/',
                 'short': ['一层小塔', 'yicengxiaota', 't16'],
                 'towerid': 'yicengxiaota'},
'yikongjian': {'auth': 'ss433_2',
               'auth2': '小艾',
               'long': 'https://ckcz123.com/games/yikongjian/',
               'short': ['异空间', 'yikongjian', 't3'],
               'towerid': 'yikongjian'},
'yiluoshenyuan': {'auth': '一条池鱼',
                  'auth2': '小艾',
                  'long': 'https://ckcz123.com/games/yiluoshenyuan/',
                  'short': ['遗落深渊', 'yiluoshenyuan', 't14'],
                  'towerid': 'yiluoshenyuan'}};
  //<!-- urlmap END -->
  for(var id in urlmap){
    urlmap[id].sortIndex={}
    urlmap[id].sortIndex.default=0;
  }
  //添加到<ul/>中
  var towerIdToHTML = function(towerId) {
    var special = '',_special='';
    if (urlmap[towerId].authString){
      special = urlmap[towerId].authString;
      _special = ' style="bottom: 50px;"';
    }
    var tags = [];
    if (urlmap[towerId].tag){
      tags.push(Array(3).join('&nbsp;')+'<span class="towerTag">')
      for (var ii=0,tag;tag=urlmap[towerId].tag[ii];ii++){
        for (var name in tag){//其实就一组键值对
          tags.push('&nbsp;&nbsp;'+name);
          urlmap[towerId].sortIndex.default+=tag[name];
        }
      }
      tags.push('</span>')
    }
    urlmap[towerId].auth = urlmap[towerId].auth||'unknow';
    urlmap[towerId].auth2 = urlmap[towerId].auth2||urlmap[towerId].auth;
    var auth = Array(3).join('&nbsp;')+'<span class="towerAuths"><span class="towerAuth">'+urlmap[towerId].auth+'</span>';
    if(urlmap[towerId].auth!==urlmap[towerId].auth2)auth+='<span class="towerAuth2">/'+urlmap[towerId].auth2+'</span>';
    auth+='</span>';
    return ['<a href="',urlmap[towerId].long,'">',
      '<div class="towerTab" id="towerId_',towerId,'"><p>',
      urlmap[towerId].short[0],auth,tags.join(''),
      '</p><p class="towerInfo"',_special,'></p>',
      special,'</div>',
      '</a>\n'
    ].join('');
  }

  var towersHTML='\n';
  Object.keys(urlmap).sort(function(a,b){return -(urlmap[a].short[2].slice(1)-urlmap[b].short[2].slice(1))}).forEach(function(towerId){
    towersHTML+= towerIdToHTML(towerId);
  });
  document.getElementById("towers").innerHTML += towersHTML;
  for(var id in urlmap){
    urlmap[id].node=document.getElementById("towerId_"+id).parentNode;
    urlmap[id].sortIndex.time=urlmap[id].short[2].slice(1);
    
  }

})();
</script>

<script>
var loadedNum =0;
function finishCallback(){
  loadedNum+=1;
  if(loadedNum==Object.keys(urlmap).length){
    for(var id in urlmap){
      urlmap[id].sortIndex.default+=urlmap[id].sortIndex.difficulty;
    }
    sortTower('default');
  }
}
queryOneTower = function(towerId) {
  var m_core={'firstData':{}};
  m_core.firstData.name=towerId;
  //m_core.firstData.version="Ver 1.3.2"
  m_core.firstData.version="";
  var pdiv=document.getElementById('towerId_'+towerId).children[1];

  m_core.drawText= function(text){
    pdiv.innerText+=''+text;
  }
  m_core.isset = function(a) {
    if (a == undefined || a == null) {
      return false;
    }
    return true;
  }
  m_core.setTwoDigits = function (x) {
    return parseInt(x)<10?"0"+x:x;
  }
  m_core.formatDate = function(date) {
    if (!m_core.isset(date)) return "";
    return date.getFullYear()+"-"+m_core.setTwoDigits(date.getMonth()+1)+"-"+m_core.setTwoDigits(date.getDate())+" "
        +m_core.setTwoDigits(date.getHours())+":"+m_core.setTwoDigits(date.getMinutes())+":"+m_core.setTwoDigits(date.getSeconds());
  }

  //====
  var formData = new FormData();
  formData.append('type', 'statistics');
  formData.append('name', m_core.firstData.name);
  formData.append('version', m_core.firstData.version);

  var xhr = new XMLHttpRequest();
  xhr.open("POST", "https://ckcz123.com/games/upload.php");

  xhr.onload = function(e) {
    if (xhr.status==200) {
      var response = JSON.parse(xhr.response);
      urlmap[towerId].response = response;
      if (response.code<0) {
        m_core.drawText("出错啦！\n无法拉取统计信息。\n错误原因："+response.msg);
        urlmap[towerId].sortIndex.popularity=0;
        urlmap[towerId].sortIndex.difficulty=0;
        urlmap[towerId].sortIndex.maxTime=0;
      }
      else {
        //var text = "\t[本塔统计信息]";
        var text="";
        var toAdd=false;
        urlmap[towerId].sortIndex.popularity=0;
        if (response.data.length==0){
          m_core.drawText('无统计信息');
          urlmap[towerId].sortIndex.difficulty=0;
          urlmap[towerId].sortIndex.maxTime=0;
        }
        response.data.forEach(function (t) {
          if (toAdd) text+="\n\n";
          toAdd=true;
          if (t.hard!='') text+=t.hard+"难度： "
          text+="已有"+t.people+"人次游戏，"+t.score+"人次通关。";
          t.info.forEach(function(ending) {
            if (ending.ending!='') {
              text+="\n"+ending.ending+"： 已有"+ending.score+"人次通关。";
            }
            if (m_core.isset(ending.max) && ending.max>0) {
              text+="\n当前MAX为"+ending.max+"，最早由 "+(ending.username||"匿名")+" 于"+m_core.formatDate(new Date(1000*ending.timestamp))+"打出。";


              urlmap[towerId].sortIndex.maxTime=1000*ending.timestamp;
            }
          })
          if(t.score==0){
            urlmap[towerId].sortIndex.difficulty=10000+parseInt(t.people);
            urlmap[towerId].sortIndex.maxTime=2345678901234+parseInt(t.people);
          } else {
            var difficulty = function(p,s){
              return p/s+10000/(Math.pow(s+1,5))
            }
            urlmap[towerId].sortIndex.difficulty=difficulty(parseInt(t.people),parseInt(t.score));
            
          }
          urlmap[towerId].sortIndex.popularity+=parseInt(t.people);
        })
        m_core.drawText(text);
      }
    }
    else {
      m_core.drawText("出错啦！\n无法拉取统计信息。\n错误原因：HTTP "+xhr.status);
      urlmap[towerId].sortIndex.popularity=0;
      urlmap[towerId].sortIndex.difficulty=0;
      urlmap[towerId].sortIndex.maxTime=0;
    }
    finishCallback();
  };
  xhr.ontimeout = function() {
    m_core.drawText("出错啦！\n无法拉取统计信息。\n错误原因：Timeout");
    urlmap[towerId].sortIndex.popularity=0;
    urlmap[towerId].sortIndex.difficulty=0;
    urlmap[towerId].sortIndex.maxTime=0;
    finishCallback();
  }
  xhr.onerror = function() {
    m_core.drawText("出错啦！\n无法拉取统计信息。\n错误原因：XHR Error");
    urlmap[towerId].sortIndex.popularity=0;
    urlmap[towerId].sortIndex.difficulty=0;
    urlmap[towerId].sortIndex.maxTime=0;
    finishCallback();
  }
  xhr.send(formData);
  //====
}
Object.keys(urlmap).forEach(function(towerId){
  queryOneTower(towerId);
});

//time,difficulty,popularity
function sortTower(index) {
  var tags={'首发':true}
  if(tags[index]){
    showTowerByTag(index);
    return;
  }
  towers=document.getElementById("towers");
  Object.keys(urlmap).sort(function(a,b){return -(urlmap[a].sortIndex[index]-urlmap[b].sortIndex[index])}).forEach(function(towerId){
    var node=urlmap[towerId].node;
    node.style.display='';
    towers.removeChild(node);
    towers.appendChild(node);
  });
}
function showTowerByTag(index) {
  for(towerId in urlmap){
    var tag = urlmap[towerId].tag||[{}];
    var show_ = (function(){
      for(var tag_ in tag){
        if(typeof(tag[tag_][index])!==typeof(undefined))return true
      }
    })();
    if(show_){
      urlmap[towerId].node.style.display='';
    } else {
      urlmap[towerId].node.style.display='none';
    }
  }
}
document.getElementById("sortTowerSelect").onchange = function(){
  sortTower(document.getElementById("sortTowerSelect").value);
}
</script>


</body>

</html>
